// ConsoleApplication1.cpp : Defines the entry point for the console application.
//

#include "stdafx.h"
#include <string.h>
#include <stdlib.h>
#include <stdio.h>
#include <windows.h>

void check(int* _cookie, int _cookie2);
int ( * foo)(char *);
int arg3=0;

int main(int argc, char *argv[])
{
		int cookie2 = 475;
		int cookie = 922;
		char buf[50];
		int* p_size;
		int* p_cookie;
		int size = 50;
		



		//__debugbreak();
		if (argc != 4) { exit(1); }
		p_cookie = &cookie;
		p_size = &size;
	    arg3 = atoi(argv[3]);
		printf("buf: %08d value \n", (int)arg3);
		
		
		
		memcpy(buf, argv[1], *p_size);
		check(p_cookie, cookie2);
		printf("printf %x \n", &foo);
		foo(argv[2]);
		
		
		return 0;
	
}

	void check(int* _cookie, int _cookie2)
	{
		if (*_cookie + _cookie2 == arg3) {
			foo = (int(*)(char *))&system;
		}
		else {
			foo = (int(*)(char *))&printf;
		}
	
		return;

	}


   

